'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = genMiddleware;

var _assert = require('assert');

var _assert2 = _interopRequireDefault(_assert);

var _yio = require('yio');

var _yio2 = _interopRequireDefault(_yio);

var _is = require('@weo-edu/is');

var _is2 = _interopRequireDefault(_is);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * Exports
 */

function genMiddleware() {
  var errorHandler = arguments.length <= 0 || arguments[0] === undefined ? defaultErrorHandler : arguments[0];
  var successHandler = arguments.length <= 1 || arguments[1] === undefined ? identity : arguments[1];

  return function (_ref) {
    var dispatch = _ref.dispatch;
    return function (next) {
      return function (action) {
        return _is2.default.generator(action) || _is2.default.generatorFunction(action) ? (0, _yio2.default)(dispatch, action).then(successHandler, errorHandler) : next(action);
      };
    };
  };
} /**
   * Imports
   */

function identity(v) {
  return v;
}

function defaultErrorHandler(err) {
  (0, _assert2.default)(err instanceof Error, 'non-error thrown: ' + err);

  var msg = err.stack || err.toString();
  console.error();
  console.error(msg.replace(/^/gm, '  '));
  console.error();
  throw err;
}